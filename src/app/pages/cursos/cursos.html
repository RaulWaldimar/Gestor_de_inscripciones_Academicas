<div class="cursos-container">
  <div class="header">
    <h1>Gestión de Cursos</h1>
    <button *ngIf="!showForm" class="btn btn-primary" (click)="showForm = true">
      + Nuevo Curso
    </button>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="alert alert-info">
    <span class="spinner"></span> Cargando cursos...
  </div>

  <!-- Error -->
  <div *ngIf="error && !loading" class="alert alert-danger">
    {{ error }}
  </div>

  <!-- Formulario -->
  <div *ngIf="showForm" class="form-modal">
    <div class="form-card">
      <h2>{{ editandoId ? 'Editar Curso' : 'Nuevo Curso' }}</h2>
      <form [formGroup]="cursoForm" (ngSubmit)="guardarCurso()">
        <div class="form-group">
          <label>Nombre *</label>
          <input type="text" formControlName="nombre" placeholder="Ingrese el nombre del curso">
          <span *ngIf="cursoForm.get('nombre')?.invalid && cursoForm.get('nombre')?.touched" class="error">
            El nombre es requerido (mínimo 3 caracteres)
          </span>
        </div>
        <div class="form-group">
          <label>Descripción *</label>
          <textarea formControlName="descripcion" placeholder="Descripción del curso"></textarea>
          <span *ngIf="cursoForm.get('descripcion')?.invalid && cursoForm.get('descripcion')?.touched" class="error">
            La descripción es requerida
          </span>
        </div>
        <div class="form-group">
          <label>Grado *</label>
          <input type="text" formControlName="grado" placeholder="Ej: 1ro, 2do, 3ro">
          <span *ngIf="cursoForm.get('grado')?.invalid && cursoForm.get('grado')?.touched" class="error">
            El grado es requerido
          </span>
        </div>
        <div class="form-group">
          <label>Sección *</label>
          <input type="text" formControlName="seccion" placeholder="Ej: A, B, C">
          <span *ngIf="cursoForm.get('seccion')?.invalid && cursoForm.get('seccion')?.touched" class="error">
            La sección es requerida
          </span>
        </div>
        <div class="form-group">
          <label>Nivel *</label>
          <input type="text" formControlName="nivel" placeholder="Ej: Primaria, Secundaria">
          <span *ngIf="cursoForm.get('nivel')?.invalid && cursoForm.get('nivel')?.touched" class="error">
            El nivel es requerido
          </span>
        </div>
        <div class="form-group">
          <label>Horario *</label>
          <input type="text" formControlName="horario" placeholder="Ej: Lunes-Viernes 9:00-10:00">
          <span *ngIf="cursoForm.get('horario')?.invalid && cursoForm.get('horario')?.touched" class="error">
            El horario es requerido
          </span>
        </div>
        <div class="form-group">
          <label>Vacantes *</label>
          <input type="number" formControlName="vacantes" placeholder="Número de vacantes" min="1">
          <span *ngIf="cursoForm.get('vacantes')?.invalid && cursoForm.get('vacantes')?.touched" class="error">
            Las vacantes son requeridas (mínimo 1)
          </span>
        </div>
        <div class="form-group">
          <label>Docente *</label>
          <input type="text" formControlName="docenteNombre" placeholder="Nombre del docente">
          <span *ngIf="cursoForm.get('docenteNombre')?.invalid && cursoForm.get('docenteNombre')?.touched" class="error">
            El docente es requerido
          </span>
        </div>
        <div class="form-group">
          <label>ID Docente *</label>
          <input type="text" formControlName="docenteId" placeholder="ID del docente en base de datos">
          <span *ngIf="cursoForm.get('docenteId')?.invalid && cursoForm.get('docenteId')?.touched" class="error">
            El ID del docente es requerido
          </span>
        </div>
        <div class="form-group">
          <label>Aula *</label>
          <input type="text" formControlName="aula" placeholder="Ej: 101, 202, A-3">
          <span *ngIf="cursoForm.get('aula')?.invalid && cursoForm.get('aula')?.touched" class="error">
            El aula es requerida
          </span>
        </div>
        <div class="form-group">
          <label>Año Académico *</label>
          <input type="number" formControlName="anioAcademico" placeholder="Año académico" min="2020">
          <span *ngIf="cursoForm.get('anioAcademico')?.invalid && cursoForm.get('anioAcademico')?.touched" class="error">
            El año académico es requerido
          </span>
        </div>
        <div class="form-actions">
          <button type="submit" class="btn btn-success" [disabled]="cursoForm.invalid">
            {{ editandoId ? 'Actualizar' : 'Crear' }}
          </button>
          <button type="button" class="btn btn-secondary" (click)="resetForm()">
            Cancelar
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Lista de Cursos -->
  <div *ngIf="!showForm && !loading && !error" class="cursos-section">
    <div class="search-bar">
      <input
        type="text"
        class="search-input"
        placeholder="Buscar por nombre o grado..."
        [(ngModel)]="buscador"
      />
    </div>

    <div *ngIf="cursosFiltrados.length === 0" class="empty-state">
      <p>No hay cursos disponibles</p>
    </div>

    <!-- Agrupado por Grado -->
    <div *ngIf="cursosFiltrados.length > 0" class="grados-container">
      <div *ngFor="let grado of gradosUnicos" class="grado-section">
        <h3 class="grado-header">Grado {{ grado }}</h3>
        
        <table class="cursos-table">
          <thead>
            <tr>
              <th>Nombre</th>
              <th>Sección</th>
              <th>Docente</th>
              <th>Horario</th>
              <th>Vacantes</th>
              <th>Aula</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let curso of obtenerCursosPorGrado(grado)">
              <td>{{ curso.nombre }}</td>
              <td class="seccion-badge">{{ curso.seccion }}</td>
              <td>{{ curso.docenteNombre }}</td>
              <td>{{ curso.horario }}</td>
              <td>{{ curso.vacantes }}</td>
              <td>{{ curso.aula }}</td>
              <td class="acciones">
                <button class="btn btn-sm btn-edit" (click)="editarCurso(curso)">Editar</button>
                <button class="btn btn-sm btn-delete" (click)="eliminarCurso(curso.id!)">Eliminar</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
